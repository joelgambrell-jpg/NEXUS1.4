<!-- form.html (FULL DROP-IN) — ONLY CHANGE: remove the lower/bottom embedded media (diagram) and the code that drives it.
     Equipment image (upper) stays as-is. -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Form</title>

<style>
body{
  margin:0;
  padding:0;
  font-family:Arial, sans-serif;
  color:#fff;
  background:#b60000;
  background-image:url("transformer.jpg");
  background-repeat:no-repeat;
  background-position:center center;
  background-size:cover;
  background-attachment:fixed;
}
.container{
  max-width:900px;
  margin:40px auto;
  background:rgba(255,255,255,0.20);
  padding:30px;
  border-radius:18px;
  backdrop-filter:blur(6px);
  text-align:center;
}
.back{
  color:#fff;
  text-decoration:none;
  font-weight:bold;
  display:inline-block;
  margin-bottom:20px;
}
h1{font-size:32px;font-weight:700;margin-top:0;}
.section-title{
  font-size:22px;
  font-weight:bold;
  margin:20px 0 8px;
  border-bottom:2px solid #fff;
  padding-bottom:6px;
}
.eq-label{font-weight:900;margin:10px 0 18px;font-size:18px;}

.button-panel{
  display:inline-block;
  background: rgba(80, 80, 80, 0.65);
  padding: 34px 54px;
  border-radius: 24px;
  backdrop-filter: blur(4px);
}
.btn{
  display:block;
  margin:18px auto;
  padding:16px 50px;
  font-size:22px;
  font-weight:700;
  border-radius:999px;
  text-decoration:none;
  color:#3ecbff;
  background:#0a0f24;
  border:2px solid #00c2ff;
  cursor:pointer;
}
.btn:hover{transform:translateY(-2px);}
.btn:disabled{opacity:0.6;cursor:not-allowed;transform:none;}
.btn.complete{
  background:#00ff66 !important;
  color:#002b14 !important;
  border-color:#00ff66 !important;
  box-shadow:0 0 14px rgba(0,255,102,.85);
}

/* NOTE: left in place even though bottom media is removed (harmless) */
.media{margin-top:20px;}
.embed{width:100%;height:75vh;border:none;border-radius:12px;background:#111;}

.nx-header-wrap{background: rgba(0,0,0,0.35);border-bottom: 1px solid rgba(255,255,255,0.18);backdrop-filter: blur(8px);}
.nx-header{max-width: 1100px;margin: 0 auto;padding: 14px 18px;display: flex;align-items: center;}
.nx-header img{height: 54px;width: auto;max-width: 100%;object-fit: contain;}

.nx-footer{
  margin-top: 40px;
  padding: 18px 12px;
  text-align: center;
  font-size: 12px;
  font-weight: 700;
  color: rgba(255,255,255,0.85);
  background: rgba(0,0,0,0.35);
  border-top: 1px solid rgba(255,255,255,0.18);
}

#stepCompleteBtn{ display:none; }
/* hidden by default; shown only when id=rif */
#rifNoProcoreBtn{ display:none; }

/* Equipment image */
#nexusEquipImageContainer{ text-align:center; margin: 10px 0 18px 0; }
#nexusEquipImageDisplay{
  display:none;
  max-width:100%;
  max-height:320px;
  border-radius:12px;
  box-shadow:0 10px 22px rgba(0,0,0,.28);
}
</style>

<link rel="stylesheet" href="assets/css/nexus-core.css">
</head>

<body>

<div id="nxSessionBanner" class="nx-session-banner">
  <div class="nx-left">
    <span class="nx-pill">Equipment: <span data-nx-eq>(none)</span></span>
    <span class="nx-pill">Role: <span data-nx-role>viewer</span></span>
    <span class="nx-pill" data-nx-status>Ready</span>
  </div>
  <div class="nx-right">
    <label style="font-weight:800;font-size:12px;opacity:.95;">Set Role
      <select id="nxRoleSelect" onchange="NEXUS.setRole(this.value)">
        <option value="viewer">viewer</option>
        <option value="tech">tech</option>
        <option value="foreman">foreman</option>
        <option value="superintendent">superintendent</option>
        <option value="admin">admin</option>
      </select>
    </label>
  </div>
</div>

<script>
(function(){
  try{
    var sel=document.getElementById("nxRoleSelect");
    if(sel && window.NEXUS && typeof window.NEXUS.getRole==="function"){
      sel.value = window.NEXUS.getRole();
    }
  }catch(e){}
})();
</script>

<a class="nx-back-btn" href="#" onclick="return NEXUS_back();">← Back</a>

<div class="nx-header-wrap">
  <div class="nx-header">
    <img src="nexus.png" alt="NEXUS" />
  </div>
</div>

<div class="container">
  <a class="back" id="backLink" href="index.html">← Back</a>

  <h1 id="page-title">Loading…</h1>
  <div id="eqLabel" class="eq-label"></div>
  <div class="section-title" id="section-title"></div>

  <!-- Equipment Image Display (UPPER IMAGE — KEEP) -->
  <div id="nexusEquipImageContainer">
    <img id="nexusEquipImageDisplay" alt="Equipment image" />
  </div>

  <div id="buttonsWrap" class="button-panel">
    <div id="buttons"></div>

    <a class="btn" id="rifNoProcoreBtn" href="rif_no_procore.html">RIF — No Procore</a>

    <button class="btn" id="openSopBtn" type="button">Open SOP</button>

    <button class="btn" id="stepCompleteBtn" type="button">Mark Step Complete</button>
  </div>

  <!-- REMOVED: bottom/embedded media area -->
  <!-- <div id="media" class="media" style="display:none;"></div> -->
</div>

<script src="config.js"></script>
<script src="app.js"></script>

<script>
(function () {
  const qs = new URLSearchParams(location.search);
  const eq = (qs.get("eq") || "").trim();
  const id = (qs.get("id") || "").trim();
  const rif = (qs.get("rif") || "").trim();

  const backLink = document.getElementById("backLink");
  if (backLink){
    backLink.href = eq ? `equipment.html?eq=${encodeURIComponent(eq)}` : "index.html";
    backLink.textContent = eq ? "← Back to Equipment" : "← Back to Home";
  }

  const label = document.getElementById("eqLabel");
  if (label) label.textContent = eq ? `Equipment: ${eq}` : "";

  (function(){
    const btn = document.getElementById("rifNoProcoreBtn");
    if(!btn) return;

    if (id !== "rif"){
      btn.style.display = "none";
      return;
    }

    const p = new URLSearchParams();
    if (eq) p.set("eq", eq);
    if (rif) p.set("rif", rif);

    btn.href = "rif_no_procore.html" + (p.toString() ? ("?" + p.toString()) : "");
    btn.style.display = "block";
  })();

  function patchLinks(){
    document.querySelectorAll('a[href]').forEach(a => {
      try{
        const href = a.getAttribute("href");
        if (!href) return;

        const url = new URL(href, location.href);
        if (url.origin !== location.origin) return;

        if (eq) url.searchParams.set("eq", eq);
        if (rif) url.searchParams.set("rif", rif);

        a.setAttribute("href", url.pathname + url.search + url.hash);
      }catch(e){}
    });
  }

  patchLinks();
  const observer = new MutationObserver(patchLinks);
  observer.observe(document.getElementById("buttons") || document.body, { childList:true, subtree:true });

  // REMOVED: any attempt to observe/patch #media specifically is unnecessary now.
})();
</script>

<!-- Equipment image loader (KEEP) -->
<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const eq = (qs.get("eq") || "").trim();
  if(!eq) return;

  const img = document.getElementById("nexusEquipImageDisplay");
  if(!img) return;

  function readLocalRecord(){
    try{ return JSON.parse(localStorage.getItem(`nexus_equipment_${eq}`) || "{}"); }
    catch(e){ return {}; }
  }

  function show(url){
    if(!url) return;
    img.src = url;
    img.style.display = "block";
  }

  const rec = readLocalRecord();
  if(rec.imageDataUrl) show(rec.imageDataUrl);

  // Firebase-ready hook
  window.NEXUS_setEquipmentImageUrl = function(url){
    show(url);
  };
})();
</script>

<script>
(function(){
  window.NEXUS_back = function(){
    const qs = new URLSearchParams(location.search);
    const eq = qs.get("eq");
    location.href = eq ? `equipment.html?eq=${encodeURIComponent(eq)}` : "equipment.html";
    return false;
  };
})();
</script>

<footer class="nx-footer">
  © 2026 NEXUS Data Science — Built for ACE Electric — All Rights Reserved
</footer>

<script src="assets/js/nexus-core.js"></script>
<script src="assets/js/nexus-firebase-bridge.js"></script>

</body>
</html>
